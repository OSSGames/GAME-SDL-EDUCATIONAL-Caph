#!/bin/bash

SRC=$(find . -maxdepth 1 -name '*.c' | sed 's/\.\///' | sort)
OBJ=$(echo $SRC | sed 's/\.c/\.o/g')

cat << EOF
# generated by mkgen
#

CC	= $CC
RM	= rm -f

CFLAGS	= $CFLAGS
LFLAGS	= $LFLAGS

OBJS	= $(echo $OBJ | sed 's/\ /\t\t\\\n\t/g')

BIN	= caph

all: \$(BIN)

\$(BIN): \$(OBJS)
	@ echo "  LD	" \$(BIN)
	@ \$(CC) -o \$@ \$^ \$(LFLAGS)

$(
for i in $SRC; do
	$CC -MT $(echo $i | sed 's/\.c/\.o/g') -MM $CFLAGS -c $i
	echo '	@ echo "  CC	" $@'
	echo '	@ $(CC) -c $(CFLAGS) -o $@ $<'
	echo ;
done
)

clean:
	@ echo "  CLEAN	"
	@ \$(RM) \$(BIN) \$(OBJS)

EOF

